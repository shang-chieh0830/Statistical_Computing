<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Random number generation | Statistical Computing</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Random number generation | Statistical Computing" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="shang-chieh0830/Statistical_Computing" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Random number generation | Statistical Computing" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Shang-Chieh" />


<meta name="date" content="2023-04-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="simulating-statistical-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Computing</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a></li>
<li class="chapter" data-level="2" data-path="random-number-generation.html"><a href="random-number-generation.html"><i class="fa fa-check"></i><b>2</b> Random number generation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="random-number-generation.html"><a href="random-number-generation.html#pseudo-random-number-generators"><i class="fa fa-check"></i><b>2.1</b> Pseudo random number generators</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="random-number-generation.html"><a href="random-number-generation.html#structure-of-prng-in-computer"><i class="fa fa-check"></i><b>2.1.1</b> Structure of PRNG in computer</a></li>
<li class="chapter" data-level="2.1.2" data-path="random-number-generation.html"><a href="random-number-generation.html#quality-of-prngs"><i class="fa fa-check"></i><b>2.1.2</b> Quality of PRNGs</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="random-number-generation.html"><a href="random-number-generation.html#the-inverse-transform-method"><i class="fa fa-check"></i><b>2.2</b> The inverse transform method</a></li>
<li class="chapter" data-level="2.3" data-path="random-number-generation.html"><a href="random-number-generation.html#rejection-sampling"><i class="fa fa-check"></i><b>2.3</b> Rejection sampling</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="random-number-generation.html"><a href="random-number-generation.html#basic-rejection-sampling"><i class="fa fa-check"></i><b>2.3.1</b> Basic Rejection Sampling</a></li>
<li class="chapter" data-level="2.3.2" data-path="random-number-generation.html"><a href="random-number-generation.html#envelope-rejection-sampling"><i class="fa fa-check"></i><b>2.3.2</b> Envelope Rejection Sampling</a></li>
<li class="chapter" data-level="2.3.3" data-path="random-number-generation.html"><a href="random-number-generation.html#choice-of-g"><i class="fa fa-check"></i><b>2.3.3</b> Choice of g</a></li>
<li class="chapter" data-level="2.3.4" data-path="random-number-generation.html"><a href="random-number-generation.html#efficiency"><i class="fa fa-check"></i><b>2.3.4</b> Efficiency</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="simulating-statistical-models.html"><a href="simulating-statistical-models.html"><i class="fa fa-check"></i><b>3</b> Simulating Statistical Models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="simulating-statistical-models.html"><a href="simulating-statistical-models.html#markov-chains"><i class="fa fa-check"></i><b>3.1</b> Markov Chains</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="simulating-statistical-models.html"><a href="simulating-statistical-models.html#discrete-case"><i class="fa fa-check"></i><b>3.1.1</b> Discrete case</a></li>
<li class="chapter" data-level="3.1.2" data-path="simulating-statistical-models.html"><a href="simulating-statistical-models.html#continuous-case"><i class="fa fa-check"></i><b>3.1.2</b> Continuous case</a></li>
<li class="chapter" data-level="3.1.3" data-path="simulating-statistical-models.html"><a href="simulating-statistical-models.html#how-the-distribution-of-x_t-changes-as-t-changes"><i class="fa fa-check"></i><b>3.1.3</b> How the distribution of <span class="math inline">\(X_t\)</span> changes as t changes?</a></li>
<li class="chapter" data-level="3.1.4" data-path="simulating-statistical-models.html"><a href="simulating-statistical-models.html#stationary-condition"><i class="fa fa-check"></i><b>3.1.4</b> Stationary Condition</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html"><i class="fa fa-check"></i><b>4</b> Monte Carlo methods</a>
<ul>
<li class="chapter" data-level="4.1" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#studying-models-via-simulation"><i class="fa fa-check"></i><b>4.1</b> Studying models via simulation</a></li>
<li class="chapter" data-level="4.2" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#monte-carlo-estimates"><i class="fa fa-check"></i><b>4.2</b> Monte Carlo estimates</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#computing-monte-carlo-estimates"><i class="fa fa-check"></i><b>4.2.1</b> Computing Monte Carlo estimates</a></li>
<li class="chapter" data-level="4.2.2" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#monte-carlo-error-and-choice-of-sample-size"><i class="fa fa-check"></i><b>4.2.2</b> Monte Carlo error and Choice of sample size</a></li>
<li class="chapter" data-level="4.2.3" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#refined-error-bounds"><i class="fa fa-check"></i><b>4.2.3</b> Refined error bounds</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#variance-reduction-methods"><i class="fa fa-check"></i><b>4.3</b> Variance reduction methods</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#importance-samplingis"><i class="fa fa-check"></i><b>4.3.1</b> Importance sampling(IS)</a></li>
<li class="chapter" data-level="4.3.2" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#antithetic-variables-av"><i class="fa fa-check"></i><b>4.3.2</b> Antithetic variables (AV)</a></li>
<li class="chapter" data-level="4.3.3" data-path="monte-carlo-methods.html"><a href="monte-carlo-methods.html#control-variates"><i class="fa fa-check"></i><b>4.3.3</b> Control variates</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Computing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="random-number-generation" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Random number generation<a href="random-number-generation.html#random-number-generation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="pseudo-random-number-generators" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Pseudo random number generators<a href="random-number-generation.html#pseudo-random-number-generators" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="definition">
<p><span id="def:unlabeled-div-1" class="definition"><strong>Definition 2.1  </strong></span><strong>PRNG</strong></p>
<p>A PRNG is an <strong>algorithm</strong> which outputs a sequence of numbers, which can be used as a <strong>replacement</strong> for an i.i.d. sequence of random numbers.</p>
</div>
<div id="structure-of-prng-in-computer" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Structure of PRNG in computer<a href="random-number-generation.html#structure-of-prng-in-computer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>States: <span class="math inline">\(s_0\xrightarrow{f} s_1 \xrightarrow{f} s_2 \xrightarrow{f} s_3 \xrightarrow{f} \dots\)</span></p>
<p>Each state gives a random number :
<span class="math display">\[s_1\xrightarrow{g}X_1\\
s_2\xrightarrow{g}X_2\\
s_3\xrightarrow{g}X_3\\
\vdots\]</span></p>
<p>where <span class="math inline">\(s_i\in S.\)</span> Here, <span class="math inline">\(S\)</span> is called the state space, <span class="math inline">\(f:S\to S\)</span> is called the mixing function and <span class="math inline">\(g:S\to \mathcal R\)</span> is called the output function.</p>
<p>Note that <span class="math inline">\(s_0\)</span> is never computed, <span class="math inline">\(s_0\)</span> is called the seed.</p>
<p><strong>Linear congruential generator (LCG)</strong></p>
<p><span class="math inline">\(mod \quad m\)</span> means that we divide by m and take the remainder(對m取餘)</p>
<p><span class="math inline">\(X_n=a(X_{n-1}+c)\quad mod \quad m,\)</span> where <span class="math inline">\(X_n \in \{0,1,...,m-1\}, a\in \{1,2,...,m-1\}\)</span>, a is called the multiplier; <span class="math inline">\(c\in \{0,1,...,m-1\}\)</span>, c is called the increment; <span class="math inline">\(m\in \mathcal N=\{1,2,3,...\}\)</span>, m is called the modulus.</p>
<p>Under LCG, there’s no difference between X and s. That is,
<span class="math inline">\(X_n\in\{0,1,...,m-1\}:=S,\quad g(s)=s, \quad f(X)=(aX+c)\quad mod\quad m\)</span></p>
<p><span class="math inline">\(X_0\in S\)</span> is the seed in LCG.</p>
<div class="example">
<p><span id="exm:unlabeled-div-2" class="example"><strong>Example 2.1  </strong></span><strong>LCG with <span class="math inline">\(m=8, a=5, c=1, X_0=0\)</span></strong></p>
<p><span class="math inline">\(X_1=(aX_0+c)\quad mod\quad m =(5\times 0+1)\quad mod\quad8=1\)</span>
<span class="math inline">\(X_2=(aX_1+c)\quad mod\quad m =(5\times 1+1)\quad mod\quad8=6\)</span>
<span class="math inline">\(X_3=(aX_2+c)\quad mod\quad m =(5\times 6+1)\quad mod\quad8=7\)</span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="random-number-generation.html#cb1-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb1-2"><a href="random-number-generation.html#cb1-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb1-3"><a href="random-number-generation.html#cb1-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="random-number-generation.html#cb1-4" aria-hidden="true" tabindex="-1"></a>X0 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-5"><a href="random-number-generation.html#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="random-number-generation.html#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="random-number-generation.html#cb1-7" aria-hidden="true" tabindex="-1"></a>Xi <span class="ot">&lt;-</span> X0</span>
<span id="cb1-8"><a href="random-number-generation.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb1-9"><a href="random-number-generation.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> (a<span class="sc">*</span>Xi <span class="sc">+</span> c)<span class="sc">%%</span>m</span>
<span id="cb1-10"><a href="random-number-generation.html#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;X_&quot;</span>, i, <span class="st">&quot; = &quot;</span>, Xi, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb1-11"><a href="random-number-generation.html#cb1-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## X_1 = 1
## X_2 = 6
## X_3 = 7
## X_4 = 4
## X_5 = 5
## X_6 = 2
## X_7 = 3
## X_8 = 0
## X_9 = 1
## X_10 = 6</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="random-number-generation.html#cb3-1" aria-hidden="true" tabindex="-1"></a>rLCG <span class="ot">&lt;-</span> <span class="cf">function</span>(n, m, a, c, X0){</span>
<span id="cb3-2"><a href="random-number-generation.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> X0</span>
<span id="cb3-3"><a href="random-number-generation.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb3-4"><a href="random-number-generation.html#cb3-4" aria-hidden="true" tabindex="-1"></a>    Xi <span class="ot">&lt;-</span> (a<span class="sc">*</span>Xi <span class="sc">+</span> c)<span class="sc">%%</span>m</span>
<span id="cb3-5"><a href="random-number-generation.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;X_&quot;</span>, i, <span class="st">&quot; = &quot;</span>, Xi, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb3-6"><a href="random-number-generation.html#cb3-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-7"><a href="random-number-generation.html#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-8"><a href="random-number-generation.html#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="random-number-generation.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rLCG</span>(<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## X_1 = 1
## X_2 = 6
## X_3 = 7
## X_4 = 4
## X_5 = 5</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="random-number-generation.html#cb5-1" aria-hidden="true" tabindex="-1"></a>rLCG <span class="ot">&lt;-</span> <span class="cf">function</span>(n, m, a, c, X0){</span>
<span id="cb5-2"><a href="random-number-generation.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb5-3"><a href="random-number-generation.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> X0</span>
<span id="cb5-4"><a href="random-number-generation.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb5-5"><a href="random-number-generation.html#cb5-5" aria-hidden="true" tabindex="-1"></a>    Xi <span class="ot">&lt;-</span> (a<span class="sc">*</span>Xi <span class="sc">+</span> c)<span class="sc">%%</span>m</span>
<span id="cb5-6"><a href="random-number-generation.html#cb5-6" aria-hidden="true" tabindex="-1"></a>    result[i] <span class="ot">&lt;-</span> Xi</span>
<span id="cb5-7"><a href="random-number-generation.html#cb5-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-8"><a href="random-number-generation.html#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb5-9"><a href="random-number-generation.html#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-10"><a href="random-number-generation.html#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="random-number-generation.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rLCG</span>(<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 1 6 7 4 5</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="random-number-generation.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rLCG</span>(<span class="dv">16</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span></code></pre></div>
<pre><code>##  [1] 1 6 7 4 5 2 3 0 1 6 7 4 5 2 3 0</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="random-number-generation.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Did you notice that it just repeat itself?</span></span>
<span id="cb9-2"><a href="random-number-generation.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This will be discuss later with the quality of PRNG</span></span>
<span id="cb9-3"><a href="random-number-generation.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># also notice m=8, so it repeats itself every 8 numbers</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="random-number-generation.html#cb10-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rLCG</span>(<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb10-2"><a href="random-number-generation.html#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="random-number-generation.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="random-number-generation.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the defult breaks on integer, which is not good</span></span>
<span id="cb11-2"><a href="random-number-generation.html#cb11-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rLCG</span>(<span class="dv">100000</span>, <span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb11-3"><a href="random-number-generation.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X) </span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="random-number-generation.html#cb12-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rLCG</span>(<span class="dv">100000</span>, <span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb12-2"><a href="random-number-generation.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">7.5</span>, <span class="dv">1</span>)) </span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="random-number-generation.html#cb13-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rLCG</span>(<span class="dv">10</span>, <span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb13-2"><a href="random-number-generation.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">7.5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="random-number-generation.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rLCG</span>(<span class="dv">10</span>, <span class="at">m=</span><span class="dv">2</span><span class="sc">^</span><span class="dv">31</span>, <span class="at">a=</span><span class="dv">1103515245</span>, <span class="at">c=</span><span class="dv">12345</span>, <span class="at">X0=</span><span class="dv">0</span>)</span></code></pre></div>
<pre><code>##  [1]      12345 1406932606  654583808 1358247936 2138638336 1459132416
##  [7] 1445521408  370866176 1896597568 1518859008</code></pre>
</div>
<p>LCG is outdated nowadays, the purpose of introducing this method is to give you a general understanding of how pseudo random numbers are produced in computer.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="random-number-generation.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the normal way to choose seed</span></span>
<span id="cb16-2"><a href="random-number-generation.html#cb16-2" aria-hidden="true" tabindex="-1"></a>?set.seed</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="random-number-generation.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0</span>)</span>
<span id="cb17-2"><a href="random-number-generation.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.8966972 0.2655087 0.3721239</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="random-number-generation.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb19-2"><a href="random-number-generation.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">runif</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 0.2655087 0.3721239 0.5728534</code></pre>
</div>
<div id="quality-of-prngs" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Quality of PRNGs<a href="random-number-generation.html#quality-of-prngs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are a number of criteria.</p>
<ol style="list-style-type: decimal">
<li>Period Length</li>
</ol>
<p>The computer has only finite memory, so we can’t have infinite state space. It turns out that PRNG starts repeating itself after a while (entering the states that it has already visited).</p>
<p>The maximum period length is <span class="math inline">\(|S|\)</span>.</p>
<p>For LCG, <span class="math inline">\(S=\{0,1,...,m-1\} \implies |S|=m\)</span></p>
<p>Note that random numbers never repeat, but pseudo random numbers DO!!
But fortunately, we can have extremely large period in R.</p>
<p>Good PRNG have large period.</p>
<ol start="2" style="list-style-type: decimal">
<li>Distribution of samples</li>
</ol>
<p>Aim: generate uniformly distributed samples.<span class="math inline">\(U(0,1)\)</span></p>
<p>For LCG, <span class="math inline">\(X_n \in \{0,1,...,m-1\}\)</span>, and we’ve seen from previous examples that LCG is indeed uniformly distributed from <span class="math inline">\(\{0,1,...,m-1\}\)</span>, note that this is not <span class="math inline">\(U(0,1)\)</span> but at least it’s uniformly distributed.</p>
<p>To get <span class="math inline">\(U(0,1)\)</span>, use the transformation <span class="math inline">\(U_n:=\frac{X_n+1}{m+1}\in (0,1)\)</span> for large m.</p>
<p>You can use histogram or check whether the PRNG visits each state exactly once (which then produces every pseudo number once) within its maximum period length.</p>
<p>Better criterion: PRNG output passes statistical tests for uniform distribution w/o problems (check example 1.6 in the book)</p>
<ol start="3" style="list-style-type: decimal">
<li>Independence of samples</li>
</ol>
<p>You can just plot <span class="math inline">\(X_n\)</span> and <span class="math inline">\(X_{n-1}\)</span> on x-axis and y-axis respectively.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="random-number-generation.html#cb21-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rLCG</span>(<span class="dv">1000</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb21-2"><a href="random-number-generation.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># m=8 which means small state space, you won&#39;t expect this small m gives you uniformly distributed plot</span></span>
<span id="cb21-3"><a href="random-number-generation.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="random-number-generation.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>], X[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>])</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="random-number-generation.html#cb22-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">rLCG</span>(<span class="dv">1000</span>, <span class="at">m=</span><span class="dv">2</span><span class="sc">^</span><span class="dv">32</span>, <span class="at">a=</span><span class="dv">1103515245</span>, <span class="at">c=</span><span class="dv">12345</span>, <span class="at">X0=</span><span class="dv">0</span>)</span>
<span id="cb22-2"><a href="random-number-generation.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="random-number-generation.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>], X[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>])</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="random-number-generation.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># well, it now looks like uniformly distributed</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="random-number-generation.html#cb24-1" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> (X<span class="sc">+</span><span class="dv">1</span>)<span class="sc">/</span>(<span class="dv">2</span><span class="sc">^</span><span class="dv">32</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb24-2"><a href="random-number-generation.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(U)</span></code></pre></div>
<pre><code>## [1] 2.874527e-06 9.979539e-01</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="random-number-generation.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">range</span>(U),<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 0.000 0.998</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="random-number-generation.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(U[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>], U[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>], <span class="at">asp=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="random-number-generation.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Great, U(0,1)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="random-number-generation.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>))</span>
<span id="cb30-2"><a href="random-number-generation.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(U[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>], U[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>], <span class="at">asp=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="random-number-generation.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use R&#39;s default PRNG: Mersenne-Twister</span></span>
<span id="cb31-2"><a href="random-number-generation.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="random-number-generation.html#cb31-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1000</span>)</span>
<span id="cb31-4"><a href="random-number-generation.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>], X[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>])</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="random-number-generation.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(X[<span class="dv">1</span><span class="sc">:</span><span class="dv">999</span>], X[<span class="dv">2</span><span class="sc">:</span><span class="dv">1000</span>], <span class="at">asp=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="random-number-generation.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can see there&#39;s no discernible pattern</span></span></code></pre></div>
<p>In fact, the states are not independent, each state is completely determined by previous state via the function f, you can check the algorithm again. So the states are definitely not independent. But what about those outputs <span class="math inline">\(X_1,X_2,...\)</span> produced by the function g? Well, then you need to choose g properly such that g will lose some information from the states and thus make those outputs <span class="math inline">\(X_1,X_2,...\)</span> independent.</p>
<p>So theoretically, they are not independent unless you can choose g cleverly.</p>
<p>From our scatter plots above, they actually look quite good.</p>
<div class="definition">
<p><span id="def:unlabeled-div-3" class="definition"><strong>Definition 2.2  </strong></span><strong>k-dimensionally equi-distributed</strong></p>
<p>A sequence of numbers is said to be k-dimensionally equidistributed if every k-tuple of possible outputs occurs equally often in this sequence.</p>
</div>
<p>For example, consider LCG with k=2, we need to consider all pairs: (1,1), (1,2), (1,3),…</p>
<p>They are 2 dimensionally equi-distributed if the frequency of all possible pairs converge to the same number.</p>
<p>k-dimensionally equi-distributed is what we would expect for a sequence of independent random numbers.</p>
<p>Good PRNG has this property for large k.</p>
<ol start="4" style="list-style-type: decimal">
<li>Role of the seed</li>
</ol>
<p>Seed will determine which of the possible output sequences of PRNG we will get.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="random-number-generation.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># always get the same output</span></span></code></pre></div>
<ul>
<li><p>Reproducible output(for reports or debugging)</p></li>
<li><p>For non-reproducible output: use techniques like current time of day as the seed.</p></li>
</ul>
</div>
</div>
<div id="the-inverse-transform-method" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> The inverse transform method<a href="random-number-generation.html#the-inverse-transform-method" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Aim: Convert <span class="math inline">\(U\sim U(0,1)\)</span> into X from a given distribution on <span class="math inline">\(\mathcal R\)</span></p>
<div class="definition">
<p><span id="def:unlabeled-div-4" class="definition"><strong>Definition 2.3  </strong></span>The cumulative distribution function (cdf) is given by <span class="math display">\[F(a)=P(X \le a)\]</span></p>
<p>Moreover, <span class="math display">\[P(X\in (a,b])=P(X \le b)-P(X\le a)=F(b)-F(a)\]</span></p>
</div>
<div class="proposition">
<p><span id="prp:unlabeled-div-5" class="proposition"><strong>Proposition 2.1  </strong></span><span class="math display">\[U \sim U(0,1), X:=F^{-1}(u)\\
\implies X \text{ has cdf } F\]</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-6" class="proof"><em>Proof</em>. </span><span class="math inline">\(F^{-1}(u):=inf\{x\in \mathcal R|F(x)\ge u \}\)</span></p>
<p>Let <span class="math inline">\(U\sim U(0,1), X=F^{-1}(u)\)</span>. Then</p>
<p><span class="math display">\[\begin{align}
P(X \le a) &amp;=P(F^{-1}(u)\le a)\\
&amp;=P(inf\{x\in \mathcal R | F(x)\ge u\}\le a)\\
&amp;=P(F(a)\ge u)\\
&amp;=P(u\le F(a))\\
&amp;=\frac{F(a)-0}{1-0}\\
&amp;=F(a)
\end{align}\]</span></p>
<p>We use the facts that <span class="math inline">\(inf\{x\in \mathcal R | F(x)\ge u\}\le a\iff F(a)\ge u\)</span> and <span class="math inline">\(U\sim U(0,1)\)</span></p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-7" class="example"><strong>Example 2.2  </strong></span>Consider <span class="math inline">\(X\sim Exp(\lambda)\)</span></p>
<p><span class="math inline">\(f(x)=\begin{cases} \lambda e^{-\lambda x} &amp; x\ge 0 \\ 0 &amp; x&lt;0 \end{cases}\)</span></p>
<p><span class="math display">\[\begin{align}
\implies F(a)=P(X\le a)&amp;=\int_{-\infty}^{a}f(x)dx=\int_{0}^{a}\lambda e^{-\lambda x}dx\\&amp;=(-e^{-\lambda x})|_{x=0}^{a}=-e^{-\lambda a}-(-e^{-\lambda 0})=1-e^{-\lambda a}
\end{align}\]</span></p>
<p><span class="math inline">\(u=F(x)=1-e^{-\lambda x} \iff e^{-\lambda x}=1-u \iff -\lambda x=log(1-u)\iff x=-\frac{log(1-u)}{\lambda}\)</span></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="random-number-generation.html#cb35-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb35-2"><a href="random-number-generation.html#cb35-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb35-3"><a href="random-number-generation.html#cb35-3" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb35-4"><a href="random-number-generation.html#cb35-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>U)<span class="sc">/</span>lambda</span>
<span id="cb35-5"><a href="random-number-generation.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb35-6"><a href="random-number-generation.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks=</span><span class="dv">50</span>)</span>
<span id="cb35-7"><a href="random-number-generation.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="random-number-generation.html#cb35-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(X), <span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb35-9"><a href="random-number-generation.html#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="random-number-generation.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">dexp</span>(x, lambda), <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
</div>
<div id="rejection-sampling" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Rejection sampling<a href="random-number-generation.html#rejection-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="basic-rejection-sampling" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Basic Rejection Sampling<a href="random-number-generation.html#basic-rejection-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For n=1,2,3,…:</p>
<p>Generate <span class="math inline">\(X_n \sim g\)</span> ( g is the proposal distribution)</p>
<p>Generate <span class="math inline">\(U_n\sim U(0,1)\)</span></p>
<p><span class="math display">\[\begin{cases}output\quad X_n (accept\quad X_n), &amp; \text{if } U_n\le p=p(X_n)\\
  ignore\quad X_n(reject \quad X_n), &amp; o.w.\end{cases}\]</span></p>
<p>Note that <span class="math inline">\(P(U\le p)=p, \forall p\in[0,1]\)</span>, so <span class="math inline">\(P(U_n\le p=p(X_n))=p=p(X_n)\)</span>, i.e. we accept <span class="math inline">\(X_n\)</span> with probability <span class="math inline">\(p=p(X_n)\)</span>. Here <span class="math inline">\(p(X_n)\)</span> is to emphasize <span class="math inline">\(p\)</span> depends on <span class="math inline">\(X_n\)</span>, <span class="math inline">\(p(X_n)\)</span> is not the pdf of <span class="math inline">\(X_n\)</span></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="random-number-generation.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first experiment about rejection sampling</span></span>
<span id="cb36-2"><a href="random-number-generation.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="random-number-generation.html#cb36-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb36-4"><a href="random-number-generation.html#cb36-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb36-5"><a href="random-number-generation.html#cb36-5" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb36-6"><a href="random-number-generation.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i<span class="sc">&lt;=</span>N){</span>
<span id="cb36-7"><a href="random-number-generation.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb36-8"><a href="random-number-generation.html#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="random-number-generation.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  X[i] <span class="ot">&lt;-</span> Xi</span>
<span id="cb36-10"><a href="random-number-generation.html#cb36-10" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb36-11"><a href="random-number-generation.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-12"><a href="random-number-generation.html#cb36-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-13"><a href="random-number-generation.html#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="random-number-generation.html#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb36-15"><a href="random-number-generation.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">50</span>)</span>
<span id="cb36-16"><a href="random-number-generation.html#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="random-number-generation.html#cb36-17" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb36-18"><a href="random-number-generation.html#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">dnorm</span>(x), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="random-number-generation.html#cb37-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb37-2"><a href="random-number-generation.html#cb37-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb37-3"><a href="random-number-generation.html#cb37-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb37-4"><a href="random-number-generation.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i<span class="sc">&lt;=</span>N){</span>
<span id="cb37-5"><a href="random-number-generation.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb37-6"><a href="random-number-generation.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb37-7"><a href="random-number-generation.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Xi<span class="sc">&lt;</span><span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>) <span class="co"># scale down the negative part</span></span>
<span id="cb37-8"><a href="random-number-generation.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(U<span class="sc">&lt;=</span>p){</span>
<span id="cb37-9"><a href="random-number-generation.html#cb37-9" aria-hidden="true" tabindex="-1"></a>    X[i] <span class="ot">&lt;-</span> Xi</span>
<span id="cb37-10"><a href="random-number-generation.html#cb37-10" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb37-11"><a href="random-number-generation.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-12"><a href="random-number-generation.html#cb37-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-13"><a href="random-number-generation.html#cb37-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-14"><a href="random-number-generation.html#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="random-number-generation.html#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb37-16"><a href="random-number-generation.html#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">50</span>)</span>
<span id="cb37-17"><a href="random-number-generation.html#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="random-number-generation.html#cb37-18" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb37-19"><a href="random-number-generation.html#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">dnorm</span>(x), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Let <span class="math inline">\(\phi(x)=\frac{1}{\sqrt{2\pi}}e^{-\frac{x^2}{2}}\)</span> be the std. normal pdf.</p>
<p>In the above codes, <code>p &lt;- ifelse(Xi&lt;0, 0.5, 1)</code> scale down the negative part by <code>1/2</code>, i.e. the area under the histogram is now 1/4 (negative part) + 1/2 (positive part) = 3/4, which is no longer 1.</p>
<p><code>p &lt;- ifelse(Xi&lt;0, 0.5, 1)</code>, you can think of this as <span class="math inline">\(p(x)\phi(x)=\begin{cases} 1\phi(x), &amp; \text{if positive part}\\ \frac{1}{2}\phi(x), &amp; \text{if negative part} \end{cases}\)</span></p>
<p>But now, <span class="math inline">\(p(x)\phi(x)\)</span> is not a probability distribution, because the area under <span class="math inline">\(p(x)\phi(x)\)</span> is 3/4. To make this be a probability distribution again, we will divide 3/4, i.e. <span class="math inline">\(\frac{1}{3/4}p(x)\phi(x)=\frac{1}{z}p(x)g(x)\)</span>, where <span class="math inline">\(z=3/4, g(x)=\phi(x)\)</span></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="random-number-generation.html#cb38-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb38-2"><a href="random-number-generation.html#cb38-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb38-3"><a href="random-number-generation.html#cb38-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-4"><a href="random-number-generation.html#cb38-4" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-5"><a href="random-number-generation.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i<span class="sc">&lt;=</span>N){</span>
<span id="cb38-6"><a href="random-number-generation.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>)</span>
<span id="cb38-7"><a href="random-number-generation.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  count <span class="ot">&lt;-</span> count<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb38-8"><a href="random-number-generation.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb38-9"><a href="random-number-generation.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Xi<span class="sc">&lt;</span><span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>) <span class="co"># scale down the negative part</span></span>
<span id="cb38-10"><a href="random-number-generation.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(U<span class="sc">&lt;=</span>p){</span>
<span id="cb38-11"><a href="random-number-generation.html#cb38-11" aria-hidden="true" tabindex="-1"></a>    X[i] <span class="ot">&lt;-</span> Xi</span>
<span id="cb38-12"><a href="random-number-generation.html#cb38-12" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb38-13"><a href="random-number-generation.html#cb38-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-14"><a href="random-number-generation.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-15"><a href="random-number-generation.html#cb38-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-16"><a href="random-number-generation.html#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="random-number-generation.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of required proposals we have </span></span>
<span id="cb38-18"><a href="random-number-generation.html#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co"># to get N accepted samples</span></span>
<span id="cb38-19"><a href="random-number-generation.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;count =&quot;</span>, count, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## count = 13278</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="random-number-generation.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb40-2"><a href="random-number-generation.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks =</span> <span class="dv">50</span>)</span>
<span id="cb40-3"><a href="random-number-generation.html#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="random-number-generation.html#cb40-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb40-5"><a href="random-number-generation.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">dnorm</span>(x) <span class="sc">*</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="proposition">
<p><span id="prp:unlabeled-div-8" class="proposition"><strong>Proposition 2.2  </strong></span>Given proposals <span class="math inline">\(X_n\sim g\)</span>, acceptance probability <span class="math inline">\(p(x)\in [0,1]\)</span></p>
<p>Let <span class="math inline">\(N_k=\)</span> index of the kth accepted proposal</p>
<p>(For example, <span class="math inline">\(X_1, X_2, X_3, X_4, ...\)</span>, say <span class="math inline">\(X_3\)</span> is rejected, then <span class="math inline">\(X_{N_1}=X_1, X_{N_2}=X_2, X_{N_3}=X_4,...\)</span>)</p>
<p>Then</p>
<ol style="list-style-type: lower-alpha">
<li><p>the accepted samples have density <span class="math display">\[f(x)=\frac{1}{z}p(x)g(x)\]</span>, i.e. <span class="math inline">\((X_{N_k})\)</span> is an i.i.d. sequence with density f.</p></li>
<li><p>Each sample is accepted with probability <span class="math inline">\(z\)</span>. The number of required proposals is geometrically distributed with mean <span class="math inline">\(\frac{1}{z}\)</span>.</p></li>
</ol>
<p>Note that <span class="math inline">\(1=\int_{\mathcal R} \frac{1}{z}p(x)g(x)dx=\frac{1}{z}\int_{\mathcal R} p(x)g(x)dx\\ \implies z=\int p(x)g(x)dx\)</span></p>
</div>
<div class="proof">
<p><span id="unlabeled-div-9" class="proof"><em>Proof</em>. </span>The probability of accepting <span class="math inline">\(X_n\)</span> is</p>
<p><span class="math display">\[\begin{align}
P(X_n accepted)&amp;=P(U_n\le p(X_n))\\
&amp;=\int_{\mathcal R}\int_{0}^{1}\boldsymbol 1_{\{U\le p(X)\}} du\quad g(x) dx\\
&amp;=\int_{\mathcal R}p(x)g(x)dx=z
\end{align}\]</span></p>
<p>Note that <span class="math inline">\(p(x)=\int_{0}^{1}\boldsymbol 1_{\{U\le p(X)\}} du\)</span> and <span class="math inline">\(\boldsymbol 1_{\{U\le p(X)\}}=\begin{cases}1, &amp; \text{if } U_n\le p(X_n)\\ 0, &amp; o.w. \end{cases}\)</span></p>
<p>Now, we want to show <span class="math inline">\(P(X_{N_k}\in A)=\int_{A}f(x)dx\)</span></p>
<p><span class="math display">\[\begin{align*}
&amp;P(X_{N_k}\in A|N_{k-1}=n) \\
&amp;=\sum_{m=1}^{\infty}P(X_{N_k}\in A, N_k=n+m|N_{k-1}=n) \\
&amp;=\sum_{m=1}^{\infty}P(X_{N_{n+m}}\in A, N_k=n+m|N_{k-1}=n) \\
&amp;=\sum_{m=1}^{\infty}P(X_{n+m}\in A, U_{n+1}&gt;p(X_{n+1}),..., U_{n+m-1}&gt;p(X_{n+m-1}), U_{n+m}\le p(X_{n+m})|N_{k-1}=n)\\
&amp;=\sum_{m=1}^{\infty}P(U_{n+1}&gt;p(X_{n+1}),..., U_{n+m-1}&gt;p(X_{n+m-1}), U_{n+m}\le p(X_{n+m}), X_{n+m}\in A|N_{k-1}=n)\\
&amp;=\sum_{m=1}^{\infty}P(U_{n+1}&gt;p(X_{n+1})|N_{k-1}=n)\times \dots \\
&amp;\quad\times P(U_{n+m-1}&gt;p(X_{n+m-1})|N_{k-1}=n)P(X_{n+m}\in A, U_{n+m}\le p(X_{n+m})|N_{k-1}=n)
\end{align*}\]</span></p>
<p>The last equation come about b/c of independence.</p>
<p>Now, observe:</p>
<p><span class="math inline">\(P(U_{n+1}&gt;p(X_{n+1})|N_{k-1}=n)=1-z\)</span></p>
<p><span class="math inline">\(\vdots\)</span></p>
<p><span class="math inline">\(P(U_{n+m-1}&gt;p(X_{n+m-1})|N_{k-1}=n)=1-z\)</span></p>
<p><span class="math inline">\(P(U_{n+m}\le p(X_{n+m}), X_{n+m}\in A|N_{k-1}=n)\\=\int_{\mathcal R}\int_{1}^{0}\boldsymbol 1_{\{U\le p(X), X\in A\}} du\quad g(x)dx\\=\int_{\mathcal R}\int_{1}^{0}\boldsymbol 1_{\{U\le p(X)\}}\boldsymbol 1_{\{ X\in A\}} du\quad g(x)dx\\=\int_{\mathcal R}\int_{1}^{0}\boldsymbol 1_{\{U\le p(X)\}}du\quad \boldsymbol 1_{\{ X\in A\}}g(x)dx\\=\int_{\mathcal R}p(x)\boldsymbol 1_{\{ X\in A\}}g(x)dx\\=\int_{A}p(x)g(x)dx\\\)</span></p>
<p>(One thing to notice: <span class="math inline">\(\boldsymbol 1_{\{U\le p(X), X\in A\}}=\boldsymbol 1_{\{U\le p(X)\}}\boldsymbol 1_{\{ X\in A\}}\)</span>, This is because these two conditions must hold at the same time to get 1)</p>
<p>Hence,
<span class="math display">\[\begin{align*}
P(X_{N_k}\in A|N_{k-1}=n)&amp;=\sum_{m=1}^{\infty}P(X_{N_k}\in A, N_k=n+m|N_{k-1}=n)\\
&amp;=\sum_{m=1}^{\infty}P(U_{n+1}&gt;p(X_{n+1})|N_{k-1}=n)\times \dots \times\\
&amp;P(U_{n+m-1}&gt;p(X_{n+m-1})|N_{k-1}=n)P(X_{n+m}\in A, U_{n+m}\le p(X_{n+m})|N_{k-1}=n)\\
&amp;= (\sum_{m=1}^{\infty}(1-z)^{m-1})\int_{A}p(x)g(x)dx\\
&amp;=(\sum_{m=0}^{\infty}(1-z)^{m})\int_{A}p(x)g(x)dx\\
&amp;=\frac{1}{1-(1-z)}\int_{A}p(x)g(x)dx\\
&amp;=\int_{A}\frac{1}{z}p(x)g(x)dx\\
&amp;=\int_{A}f(x)dx
\end{align*}\]</span>
, which is true independent of n</p>
<p>Hence <span class="math inline">\(P(X_{N_k}\in A)=\int_{A}f(x)dx\)</span>, i.e. <span class="math inline">\(X_{N_k}\)</span> has desity f.</p>
<p>Recall the fact that <span class="math inline">\(\sum_{m=0}^{\infty}a^m=\frac{1}{1-a},\forall |a|&lt;1\)</span></p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-10" class="example"><strong>Example 2.3  </strong></span>Consider <span class="math inline">\(X_n\sim U(-1,+1)\implies g(x)=\boldsymbol 1_{[-1,+1]}\times \frac{1}{2}\)</span>, and <span class="math inline">\(p(x)=\sqrt{1-x^2}\)</span>, which is the upper half of the unit circle.</p>
<p>Then <span class="math inline">\(f(x)=\frac{1}{z}p(x)g(x)=\frac{1}{z}\times \begin{cases} \sqrt{1-x^2}\times \frac{1}{2}, &amp; \forall x\in [-1,+1]\\ 0, &amp; \forall x \notin[-1,+1] \end{cases}\)</span></p>
<p>So, <span class="math inline">\(z=\int_{-1}^{+1}p(x)g(x)dx=\int_{-1}^{+1}\sqrt{1-x^2}\times 1/2dx=1/2\int_{-1}^{+1}\sqrt{1-x^2}dx\\=1/2\times \frac{1}{2}\pi1^2\\=\pi/4\)</span></p>
<p>This implies the accepted samples have density
<span class="math display">\[f(x)=\begin{cases}2/\pi\sqrt{1-x^2} &amp; \forall x\in [-1,+1]\\0 &amp; o.w. \end{cases}\]</span></p>
<p>In fact, this distribution f(x) is the so-called Wigner semicircle distribution.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="random-number-generation.html#cb41-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb41-2"><a href="random-number-generation.html#cb41-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb41-3"><a href="random-number-generation.html#cb41-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb41-4"><a href="random-number-generation.html#cb41-4" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-5"><a href="random-number-generation.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i<span class="sc">&lt;=</span>N){</span>
<span id="cb41-6"><a href="random-number-generation.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb41-7"><a href="random-number-generation.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  count <span class="ot">&lt;-</span> count<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb41-8"><a href="random-number-generation.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb41-9"><a href="random-number-generation.html#cb41-9" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>Xi<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb41-10"><a href="random-number-generation.html#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(U<span class="sc">&lt;=</span>p){</span>
<span id="cb41-11"><a href="random-number-generation.html#cb41-11" aria-hidden="true" tabindex="-1"></a>    X[i] <span class="ot">&lt;-</span> Xi</span>
<span id="cb41-12"><a href="random-number-generation.html#cb41-12" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb41-13"><a href="random-number-generation.html#cb41-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-14"><a href="random-number-generation.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-15"><a href="random-number-generation.html#cb41-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-16"><a href="random-number-generation.html#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="random-number-generation.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of required proposals we have </span></span>
<span id="cb41-18"><a href="random-number-generation.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># to get N accepted samples</span></span>
<span id="cb41-19"><a href="random-number-generation.html#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;count =&quot;</span>, count, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## count = 12732</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="random-number-generation.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb43-2"><a href="random-number-generation.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">main=</span><span class="cn">NULL</span>, <span class="at">prob=</span><span class="cn">TRUE</span>,<span class="at">asp=</span><span class="dv">1</span>)</span>
<span id="cb43-3"><a href="random-number-generation.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="random-number-generation.html#cb43-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out=</span> <span class="dv">100</span>)</span>
<span id="cb43-5"><a href="random-number-generation.html#cb43-5" aria-hidden="true" tabindex="-1"></a>f.of.x <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">/</span>pi <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span></span>
<span id="cb43-6"><a href="random-number-generation.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, f.of.x, <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="random-number-generation.html#cb44-1" aria-hidden="true" tabindex="-1"></a>z<span class="ot">=</span>pi<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb44-2"><a href="random-number-generation.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The number of required proposals is geometrically distributed</span></span>
<span id="cb44-3"><a href="random-number-generation.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># with mean 1/z</span></span>
<span id="cb44-4"><a href="random-number-generation.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="random-number-generation.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>z</span></code></pre></div>
<pre><code>## [1] 1.27324</code></pre>
</div>
</div>
<div id="envelope-rejection-sampling" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Envelope Rejection Sampling<a href="random-number-generation.html#envelope-rejection-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Recall: In previous sections, we generate <span class="math inline">\(X\sim g\)</span> and <span class="math inline">\(U\sim U(0,1)\)</span>. We accept X, if <span class="math inline">\(U\le p(X)\)</span>.</p>
<p>Also, accepted sample have density <span class="math inline">\(f(x)=\frac{1}{z}p(x)g(x)\)</span>. Note that this implies <span class="math inline">\(p(x)=constant\times\frac{f(x)}{g(x)}.\)</span></p>
<p>But <span class="math inline">\(p(x)\)</span> is a probability, so we must have <span class="math inline">\(\frac{f(x)}{g(x)}\)</span> to be bounded, i.e. <span class="math inline">\(f(x)\le c\times g(x),\forall x\)</span> for some constant c, so that we can adjust the constant term in <span class="math inline">\(p(x)=constant\times\frac{f(x)}{g(x)}\)</span> such that <span class="math inline">\(p(x)\in [0,1].\)</span> It turns out this constant term is <span class="math inline">\(\frac{1}{c}\)</span>, i.e. <span class="math inline">\(p(x)=\frac{1}{c}\frac{f(x)}{g(x)}\)</span></p>
<p>In this section, instead of finding what <span class="math inline">\(f\)</span> is, <span class="math inline">\(f\)</span> is already <strong>GIVEN</strong>, envelope rejection sampling can do this.</p>
<p><span class="math inline">\(f(x)\le c\times g(x),\forall x\)</span>, is why we call it envelope rejection sampling.</p>
<p>We will only require f to known up to a multiplicative constant (e.g. instead of knowing <span class="math inline">\(f(x)=\frac{1}{\sqrt{2\pi}}e^{-x^2/2}\)</span>, we only need to know <span class="math inline">\(f(x)=e^{-x^2/2}\)</span>), and we assume <span class="math inline">\(f(x)\ge 0\)</span> (don’t need to integrate to 1.), to get samples from <span class="math display">\[\tilde f(x)=\frac{1}{z_f}f(x), z_f=\int_{\mathcal R}f(x)dx\]</span></p>
<div class="proposition">
<p><span id="prp:unlabeled-div-11" class="proposition"><strong>Proposition 2.3  </strong></span>Input: <span class="math inline">\(f: \mathcal R \to [0,\infty)\)</span> with <span class="math inline">\(z_f=\int f(x)dx&lt;\infty\)</span>, <span class="math inline">\(g: \mathcal R \to [0,\infty)\)</span> be a probability density, and a constant c such that <span class="math inline">\(f(x)\le cg(x)\)</span></p>
<p>Generate <span class="math inline">\(X\sim g\)</span> and <span class="math inline">\(U\sim U(0,1)\)</span>. We accept X, if <span class="math inline">\(cg(x)\times U\le f(x)\)</span> (you can write <span class="math inline">\(U\le \frac{f(x)}{cg(x)}\)</span>, but make sure that the denominator ≠ 0)</p>
<p>Then we have:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Accepted samples have density <span class="math inline">\(\tilde f(x)=\frac{1}{z_f}f(x)\)</span></p></li>
<li><p>Each proposal is accepted with probability <span class="math inline">\(\frac{z_f}{c}\)</span>, and mean number of proposals per output is <span class="math inline">\(\frac{c}{z_f}\)</span></p></li>
</ol>
</div>
<div class="proof">
<p><span id="unlabeled-div-12" class="proof"><em>Proof</em>. </span>Each proposal is accepted with probability <span class="math inline">\(p(x)=\begin{cases} \frac{f(x)}{cg(x)} &amp; \text{ if } g(x)&gt;0 \\ 1 &amp; \text{ if } g(x)=0 \end{cases}.\)</span> Note that when <span class="math inline">\(g(x)=0\)</span>, <span class="math inline">\(cg(x)\times U=0\le f(x)\)</span> always holds b/c we also assume <span class="math inline">\(f(x)&gt;0\)</span>, so we must accept X when <span class="math inline">\(g(x)=0\)</span></p>
<p>By basic rejection sampling, the accepted samples have density <span class="math inline">\(\frac{1}{z}p(x)g(x)=\begin{cases} \frac{1}{z}\frac{f(x)}{cg(x)}g(x)=f(x)/zc &amp; \text{ if } g(x)&gt;0\\ \frac{1}{z}\times 1\times g(x)=0 &amp; \text{ if }g(x)=0\end{cases}\)</span></p>
<p>In fact, from the above we get <span class="math inline">\(\frac{1}{z}p(x)g(x)=\frac{f(x)}{zc}\)</span> no matter whether <span class="math inline">\(g(x)=0\)</span>. This is b/c <span class="math inline">\(f(x)\le c\times g(x),\forall x\)</span> so <span class="math inline">\(g(x)=0\implies f(x)=0\)</span></p>
<p><span class="math inline">\(z=\int p(x)g(x)dx=\frac{1}{c}\int f(x)dx=\frac{z_f}{c}\\ \implies\frac{1}{z}p(x)g(x)=\frac{c}{z_f}\frac{f(x)}{c}=\frac{1}{z_f}f(x)=\tilde f(x)\)</span></p>
<p>Each sample is accepted with probability <span class="math inline">\(z=z_f/c\)</span></p>
</div>
<div class="example">
<p><span id="exm:unlabeled-div-13" class="example"><strong>Example 2.4  </strong></span>Consider <span class="math inline">\(f(x)=e^{-x^2/2}\)</span>, we want to find some constant c and proposal <span class="math inline">\(g(x)\)</span> so that <span class="math inline">\(f(x)\le cg(x)\)</span></p>
<p>Since <span class="math inline">\(f(x)\)</span> is pretty similar to std. Normal, one can consider <span class="math inline">\(g(x)\)</span> to be double exponential distribution.</p>
<p>For proposals: <span class="math inline">\(X\sim \frac{\lambda}{2}e^{-\lambda|x|}=:g(x)\)</span></p>
<p>(Let’s digress a little bit, how can we use inverse transform sampling to generate random samples from double exponential distribution?</p>
<p>Steps:</p>
<p>Generate <span class="math inline">\(U\sim U(0,1)\)</span>,</p>
<p>Generate <span class="math inline">\(Y=-\frac{log(1-U)}{\lambda}\)</span></p>
<p>(note that this is from exponential distribution, so it only has positive side of double exponential),</p>
<p>Generate <span class="math inline">\(V\sim U(0,1)\)</span></p>
<p>(double exponential is symmetric to 0),</p>
<p>and let <span class="math inline">\(X=\begin{cases}Y, &amp; V\le1/2 \\-Y, &amp; V&gt;1/2 \end{cases}\)</span></p>
<p>)</p>
<p>Now, can we find c with <span class="math inline">\(f(x)\le cg(x), \forall x\in \mathcal R\)</span>, or equivalently, <span class="math inline">\(f(x)/g(x)\le c, \forall x\in \mathcal R\)</span>?</p>
<p>(The equivalence holds b/c g(x) is never 0 in this example)</p>
<p><span class="math inline">\(\frac{f(x)}{g(x)}=\frac{e^{-x^2/2}}{\frac{\lambda}{2}e^{-\lambda |x|}}=\frac{2}{\lambda}e^{-\frac{x^2}{2}+\lambda |x|}\)</span></p>
<p>Note that double exponential distribution is symmetric to 0, so we can simply consider the positive part (<span class="math inline">\(x\ge 0\)</span>), so now we have <span class="math inline">\(\frac{f(x)}{g(x)}=\frac{2}{\lambda}e^{-\frac{x^2}{2}+\lambda |x|}=\frac{2}{\lambda}e^{-\frac{x^2}{2}+\lambda x}\)</span></p>
<p>Also note that by F.O.C, we have <span class="math inline">\(0=(-\frac{x^2}{2}+\lambda x)&#39;=-x+\lambda \iff x=\lambda\)</span>, i.e. <span class="math inline">\(-\frac{x^2}{2}+\lambda x\)</span> has max at <span class="math inline">\(x=\lambda\)</span></p>
<p>This gives <span class="math inline">\(\frac{f(x)}{g(x)}=\frac{2}{\lambda}e^{-\frac{x^2}{2}+\lambda |x|}=\frac{2}{\lambda}e^{-\frac{x^2}{2}+\lambda x}\le \frac{2}{\lambda}e^{-\frac{\lambda^2}{2}+\lambda^2}=\frac{2}{\lambda}e^{\frac{\lambda^2}{2}}=:c\)</span></p>
<p>So yes, we found c with <span class="math inline">\(f(x)/g(x)\le c, \forall x\in \mathcal R\)</span></p>
<p>Now, following the steps in envelope rejection sampling, we then:</p>
<p>Generate <span class="math inline">\(W\sim U(0,1)\)</span>, and accept X if <span class="math inline">\(cg(x)\times W\le f(x) \\ \implies \frac{2}{\lambda}e^{\frac{\lambda^2}{2}}\frac{\lambda}{2}e^{-\lambda|x|}W\le e^{-x^2/2}\\ \implies W\le exp(-\frac{x^2}{2}+\lambda |x|-\frac{\lambda^2}{2})\)</span></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="random-number-generation.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># converting double-exponential to normal distribution</span></span>
<span id="cb46-2"><a href="random-number-generation.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using rejection sampling</span></span>
<span id="cb46-3"><a href="random-number-generation.html#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="random-number-generation.html#cb46-4" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb46-5"><a href="random-number-generation.html#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="random-number-generation.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">#non-normalized target distribution</span></span>
<span id="cb46-7"><a href="random-number-generation.html#cb46-7" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>) </span>
<span id="cb46-8"><a href="random-number-generation.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="random-number-generation.html#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># proposal density</span></span>
<span id="cb46-10"><a href="random-number-generation.html#cb46-10" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) lambda<span class="sc">/</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>lambda<span class="sc">*</span><span class="fu">abs</span>(x))</span>
<span id="cb46-11"><a href="random-number-generation.html#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="random-number-generation.html#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co"># const c for envelope sampling</span></span>
<span id="cb46-13"><a href="random-number-generation.html#cb46-13" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">/</span>lambda <span class="sc">*</span> <span class="fu">exp</span>(lambda<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb46-14"><a href="random-number-generation.html#cb46-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-15"><a href="random-number-generation.html#cb46-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb46-16"><a href="random-number-generation.html#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, c<span class="sc">*</span><span class="fu">g</span>(x), <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb46-17"><a href="random-number-generation.html#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">f</span>(x))</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="random-number-generation.html#cb47-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb47-2"><a href="random-number-generation.html#cb47-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb47-3"><a href="random-number-generation.html#cb47-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>U)<span class="sc">/</span>lambda</span>
<span id="cb47-4"><a href="random-number-generation.html#cb47-4" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb47-5"><a href="random-number-generation.html#cb47-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(V<span class="sc">&lt;=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, Y, <span class="sc">-</span>Y)</span>
<span id="cb47-6"><a href="random-number-generation.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="random-number-generation.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>))</span>
<span id="cb47-8"><a href="random-number-generation.html#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks=</span><span class="dv">50</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb47-9"><a href="random-number-generation.html#cb47-9" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb47-10"><a href="random-number-generation.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">g</span>(x), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="random-number-generation.html#cb48-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb48-2"><a href="random-number-generation.html#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="random-number-generation.html#cb48-3" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">rexp</span>(N, lambda)</span>
<span id="cb48-4"><a href="random-number-generation.html#cb48-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(V<span class="sc">&lt;=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, Y, <span class="sc">-</span>Y)</span>
<span id="cb48-5"><a href="random-number-generation.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="random-number-generation.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>))</span>
<span id="cb48-7"><a href="random-number-generation.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks=</span><span class="dv">50</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb48-8"><a href="random-number-generation.html#cb48-8" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb48-9"><a href="random-number-generation.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">g</span>(x), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="random-number-generation.html#cb49-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb49-2"><a href="random-number-generation.html#cb49-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">numeric</span>(N)</span>
<span id="cb49-3"><a href="random-number-generation.html#cb49-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb49-4"><a href="random-number-generation.html#cb49-4" aria-hidden="true" tabindex="-1"></a>count <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb49-5"><a href="random-number-generation.html#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="random-number-generation.html#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i<span class="sc">&lt;=</span>N){</span>
<span id="cb49-7"><a href="random-number-generation.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb49-8"><a href="random-number-generation.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span><span class="sc">-</span>U)<span class="sc">/</span> lambda</span>
<span id="cb49-9"><a href="random-number-generation.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb49-10"><a href="random-number-generation.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  Xi <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(V<span class="sc">&lt;=</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, Y, <span class="sc">-</span>Y)</span>
<span id="cb49-11"><a href="random-number-generation.html#cb49-11" aria-hidden="true" tabindex="-1"></a>  count <span class="ot">&lt;-</span> count<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb49-12"><a href="random-number-generation.html#cb49-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-13"><a href="random-number-generation.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  W <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb49-14"><a href="random-number-generation.html#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="random-number-generation.html#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(c<span class="sc">*</span><span class="fu">g</span>(Xi)<span class="sc">*</span>W <span class="sc">&lt;=</span> <span class="fu">f</span>(Xi)){</span>
<span id="cb49-16"><a href="random-number-generation.html#cb49-16" aria-hidden="true" tabindex="-1"></a>    X[i] <span class="ot">&lt;-</span> Xi</span>
<span id="cb49-17"><a href="random-number-generation.html#cb49-17" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i<span class="sc">+</span><span class="dv">1</span>  </span>
<span id="cb49-18"><a href="random-number-generation.html#cb49-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-19"><a href="random-number-generation.html#cb49-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-20"><a href="random-number-generation.html#cb49-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-21"><a href="random-number-generation.html#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="random-number-generation.html#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;count =&quot;</span>, count, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## count = 131439</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="random-number-generation.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="fl">0.9</span>,<span class="fl">0.9</span>,<span class="fl">0.2</span>,<span class="fl">0.1</span>))</span>
<span id="cb51-2"><a href="random-number-generation.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(X, <span class="at">prob=</span><span class="cn">TRUE</span>, <span class="at">breaks=</span><span class="dv">50</span>, <span class="at">main=</span><span class="cn">NULL</span>)</span>
<span id="cb51-3"><a href="random-number-generation.html#cb51-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>,<span class="dv">4</span>, <span class="at">length.out=</span><span class="dv">200</span>)</span>
<span id="cb51-4"><a href="random-number-generation.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x, <span class="fu">dnorm</span>(x), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="01-RNG_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
</div>
</div>
<div id="choice-of-g" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Choice of g<a href="random-number-generation.html#choice-of-g" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>We must be able to efficiently generate samples from g</p></li>
<li><p>We must have <span class="math inline">\(f(x)\le cg(x), \forall x\)</span>. In particular, g must have heavier tails than f, i.e. we cannot have <span class="math display">\[\lim_{|x|\to \infty}\frac{g(x)}{f(x)}=0\]</span>, i.e. <span class="math inline">\(g(x)\to 0\)</span> faster than <span class="math inline">\(f(x)\to 0\)</span></p></li>
</ul>
<div class="example">
<p><span id="exm:unlabeled-div-14" class="example"><strong>Example 2.5  </strong></span></p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(f(x)\sim e^{-x^2/2}, g\sim e^{-\lambda|x|}\)</span>, note that <span class="math inline">\(e^{-x^2/2}\)</span> decays faster than <span class="math inline">\(e^{-\lambda|x|}\)</span> as <span class="math inline">\(|x|\to \infty\)</span> so this example works fine.</p></li>
<li><p><span class="math inline">\(f(x)\sim \frac{1}{x^\beta}\)</span> (for large x), <span class="math inline">\(g\sim e^{-\lambda x}\)</span>, note that <span class="math inline">\(\frac{1}{x^\beta}\)</span> decays slower <span class="math inline">\(\implies\)</span> cannot find c, so this example doesn’t work.</p></li>
</ol>
</div>
</div>
<div id="efficiency" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Efficiency<a href="random-number-generation.html#efficiency" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>On average, we need <span class="math inline">\(\frac{c}{z_f}\)</span> proposals to generate one sample.</p>
<ol style="list-style-type: decimal">
<li><p>We should minimize c for given f and g !!</p></li>
<li><p>g should have a similar shape to f.</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simulating-statistical-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"repo": "https://github.com/shang-chieh0830/Statistical_Computing"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
